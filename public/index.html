<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø¥Ø¶Ø§ÙØ© YouCan Ù„Ù„ÙƒØ´Ù Ø¹Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 40px; border-radius: 15px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); text-align: center; }
        h1 { color: #2d3748; margin-bottom: 20px; }
        .test-btn { background: linear-gradient(135deg, #4c51bf 0%, #6b46c1 100%); color: white; border: none; padding: 15px 30px; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; display: inline-flex; align-items: center; gap: 10px; margin: 20px 0; }
        .test-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(76, 81, 191, 0.3); }
        .result { background: #f7fafc; padding: 20px; border-radius: 8px; margin-top: 20px; text-align: left; display: none; }
        .success { color: #10b981; }
        .error { color: #dc2626; }
        .spinner { display: inline-block; width: 20px; height: 20px; border: 3px solid rgba(255,255,255,0.3); border-radius: 50%; border-top-color: white; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± Ø¥Ø¶Ø§ÙØ© YouCan Ù„Ù„ÙƒØ´Ù Ø¹Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹</h1>
        <p>Ø§Ø®ØªØ¨Ø§Ø± API ÙˆØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§</p>
        
        <div style="margin: 30px 0;">
            <button class="test-btn" onclick="testAPI()">
                <span id="apiSpinner" class="spinner" style="display: none;"></span>
                ğŸ” Ø§Ø®ØªØ¨Ø§Ø± API
            </button>
            <button class="test-btn" onclick="testGeolocation()">
                <span id="geoSpinner" class="spinner" style="display: none;"></span>
                ğŸ“ Ø§Ø®ØªØ¨Ø§Ø± ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹
            </button>
        </div>
        
        <div id="apiResult" class="result"></div>
        <div id="geoResult" class="result"></div>
        
        <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #e2e8f0;">
            <h3>ğŸ”— Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:</h3>
            <ul style="text-align: right; padding-right: 20px; margin-top: 10px;">
                <li><a href="/api/health">/api/health</a> - ÙØ­Øµ Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø§Ø¯Ù…</li>
                <li><a href="/admin">/admin</a> - Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</li>
                <li><a href="/widget.js">/widget.js</a> - Ø³ÙƒØ±ÙŠØ¨Øª Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©</li>
                <li><a href="/install?shop=test">/install</a> - ØªØ«Ø¨ÙŠØª Ø§Ù„Ø¥Ø¶Ø§ÙØ©</li>
            </ul>
        </div>
    </div>
    
    <script>
        async function testAPI() {
            const spinner = document.getElementById('apiSpinner');
            const result = document.getElementById('apiResult');
            
            spinner.style.display = 'inline-block';
            result.style.display = 'none';
            
            try {
                const response = await fetch('/api/health');
                const data = await response.json();
                
                result.innerHTML = `
                    <h3 class="success">âœ… API ÙŠØ¹Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­</h3>
                    <p><strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> ${data.status}</p>
                    <p><strong>Ø§Ù„Ø®Ø¯Ù…Ø©:</strong> ${data.service}</p>
                    <p><strong>Ø§Ù„Ø¥ØµØ¯Ø§Ø±:</strong> ${data.version}</p>
                    <p><strong>Ø§Ù„ÙˆÙ‚Øª:</strong> ${data.timestamp}</p>
                    <p><strong>Ù…Ø¯Ø© Ø§Ù„ØªØ´ØºÙŠÙ„:</strong> ${data.uptime.toFixed(2)} Ø«Ø§Ù†ÙŠØ©</p>
                `;
                result.style.display = 'block';
            } catch (error) {
                result.innerHTML = `
                    <h3 class="error">âŒ ÙØ´Ù„ Ø§Ø®ØªØ¨Ø§Ø± API</h3>
                    <p>Ø§Ù„Ø®Ø·Ø£: ${error.message}</p>
                `;
                result.style.display = 'block';
            } finally {
                spinner.style.display = 'none';
            }
        }
        
        async function testGeolocation() {
            const spinner = document.getElementById('geoSpinner');
            const result = document.getElementById('geoResult');
            
            spinner.style.display = 'inline-block';
            result.style.display = 'none';
            
            if (!navigator.geolocation) {
                result.innerHTML = '<h3 class="error">âŒ Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹</h3>';
                result.style.display = 'block';
                spinner.style.display = 'none';
                return;
            }
            
            try {
                const position = await new Promise((resolve, reject) => {
                    navigator.geolocation.getCurrentPosition(resolve, reject, {
                        enableHighAccuracy: true,
                        timeout: 10000
                    });
                });
                
                const geoResponse = await fetch('/api/geocode', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        lat: position.coords.latitude,
                        lng: position.coords.longitude,
                        language: 'ar'
                    })
                });
                
                const geoData = await geoResponse.json();
                
                if (geoData.success) {
                    result.innerHTML = `
                        <h3 class="success">âœ… ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹Ùƒ Ø¨Ù†Ø¬Ø§Ø­</h3>
                        <p><strong>Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª:</strong> ${position.coords.latitude.toFixed(6)}, ${position.coords.longitude.toFixed(6)}</p>
                        <p><strong>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</strong> ${geoData.address.formatted}</p>
                        <p><strong>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©:</strong> ${geoData.address.components.city}</p>
                        <p><strong>Ø§Ù„Ø¯ÙˆÙ„Ø©:</strong> ${geoData.address.components.country}</p>
                        <p><strong>Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø¨Ø±ÙŠØ¯ÙŠ:</strong> ${geoData.address.components.zip || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}</p>
                        <p><strong>Ø§Ù„Ù…ØµØ¯Ø±:</strong> ${geoData.source}</p>
                    `;
                } else {
                    throw new Error(geoData.error);
                }
            } catch (error) {
                result.innerHTML = `
                    <h3 class="error">âŒ ÙØ´Ù„ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹</h3>
                    <p>Ø§Ù„Ø®Ø·Ø£: ${error.message}</p>
                    <p>Ù‚Ø¯ ÙŠÙƒÙˆÙ† Ø§Ù„Ø³Ø¨Ø¨:</p>
                    <ul>
                        <li>Ø±ÙØ¶ Ø§Ù„Ø¥Ø°Ù† Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹</li>
                        <li>Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§ØªØµØ§Ù„ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª</li>
                        <li>Ø®Ø·Ø£ ÙÙŠ Ø®Ø¯Ù…Ø© OpenStreetMap</li>
                    </ul>
                `;
            } finally {
                result.style.display = 'block';
                spinner.style.display = 'none';
            }
        }
        
        // Ø§Ø®ØªØ¨Ø§Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
        window.addEventListener('load', () => {
            setTimeout(testAPI, 1000);
        });
    </script>
</body>
</html>